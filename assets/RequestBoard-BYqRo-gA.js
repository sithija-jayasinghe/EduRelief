import{s as d,j as e}from"./index-CTmt-P1O.js";import{r as l}from"./router-DmZmTQD2.js";import{k as b,l as y,f as v,m as q,U as w,X as _}from"./icons-C3RlEb-g.js";import"./react-vendor-ZjeaK7N3.js";import"./supabase-C8HnRnw-.js";function G({onUploadClick:h}){const[o,i]=l.useState([]),[x,p]=l.useState(!0),[j,c]=l.useState(!1),[t,n]=l.useState({subject:"",grade:"Grade 6-9",note_content:"",student_name:""}),[m,u]=l.useState(!1);l.useEffect(()=>{f()},[]);const f=async()=>{try{const{data:s,error:r}=await d.from("requests").select("*").order("created_at",{ascending:!1});if(r)throw r;i(s||[])}catch(s){console.error("Error fetching requests:",s)}finally{p(!1)}},g=async(s,r)=>{i(o.map(a=>a.id===s?{...a,upvotes:r+1}:a));try{const{error:a}=await d.from("requests").update({upvotes:r+1}).eq("id",s);if(a)throw a}catch(a){console.error("Error upvoting:",a)}},N=async s=>{s.preventDefault(),u(!0);try{const{data:r,error:a}=await d.from("requests").insert([{student_name:t.student_name,subject:t.subject,grade:t.grade,note_content:t.note_content}]).select();if(a)throw a;r&&i([r[0],...o]),n({subject:"",grade:"Grade 6-9",note_content:"",student_name:""}),c(!1)}catch(r){console.error("Error posting request:",r),alert("Failed to post request. Please try again.")}finally{u(!1)}};return e.jsxs("div",{className:"container py-16",children:[e.jsxs("div",{className:"flex justify-between items-end mb-10",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl mb-2",children:"Community Requests"}),e.jsx("p",{className:"text-gray-500",children:"Can't find what you need? Post a request and let the community help you out."})]}),e.jsx("div",{children:e.jsxs("button",{onClick:()=>c(!0),className:"btn-primary",children:[e.jsx(b,{size:20}),"Post a Request"]})})]}),x?e.jsx("div",{className:"text-center py-16",children:e.jsx("p",{className:"text-gray-500",children:"Loading community requests..."})}):o.length===0?e.jsx("div",{className:"text-center py-16 upload-area",children:e.jsx("p",{className:"text-gray-500 text-lg",children:"No requests yet. Be the first to ask!"})}):e.jsx("div",{className:"notes-grid",children:o.map(s=>e.jsxs("div",{className:"request-card",children:[e.jsxs("div",{className:"request-header",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"tag tag-grade",children:s.grade}),e.jsx("span",{className:"tag tag-grade",children:s.subject})]}),s.fulfilled?e.jsxs("span",{className:"status-badge status-fulfilled",children:[e.jsx(y,{size:14})," Fulfilled"]}):e.jsxs("span",{className:"status-badge status-open",children:[e.jsx(v,{size:14})," Open"]})]}),e.jsx("h3",{className:"card-title mb-4",children:s.note_content}),e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"logo-icon",style:{width:"24px",height:"24px",padding:0,justifyContent:"center",alignItems:"center",fontSize:"12px"},children:s.student_name.charAt(0)}),e.jsxs("span",{className:"text-gray-500",style:{fontSize:"0.875rem"},children:["Requested by ",s.student_name]})]}),e.jsxs("div",{className:"card-footer",children:[e.jsxs("button",{onClick:()=>g(s.id,s.upvotes),className:"btn-icon",style:{display:"flex",gap:"0.5rem",alignItems:"center",width:"auto"},children:[e.jsx(q,{size:18}),e.jsxs("span",{children:[s.upvotes," Boosts"]})]}),!s.fulfilled&&e.jsxs("button",{onClick:h,className:"text-primary",style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",fontWeight:"bold"},children:[e.jsx(w,{size:16}),"I have this"]})]})]},s.id))}),j&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{className:"text-3xl",style:{fontSize:"1.25rem",fontWeight:"bold"},children:"Request Study Material"}),e.jsx("button",{onClick:()=>c(!1),className:"btn-icon",children:e.jsx(_,{size:20})})]}),e.jsxs("form",{onSubmit:N,className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Your Name"}),e.jsx("input",{type:"text",placeholder:"e.g. Kasun Perera",className:"form-input",required:!0,value:t.student_name,onChange:s=>n({...t,student_name:s.target.value})})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-col",children:[e.jsx("label",{className:"form-label",children:"Subject"}),e.jsx("input",{type:"text",placeholder:"e.g. Combined Maths",className:"form-input",required:!0,value:t.subject,onChange:s=>n({...t,subject:s.target.value})})]}),e.jsxs("div",{className:"form-col",children:[e.jsx("label",{className:"form-label",children:"Grade"}),e.jsxs("select",{className:"form-select",value:t.grade,onChange:s=>n({...t,grade:s.target.value}),children:[e.jsx("option",{children:"Grade 1-5"}),e.jsx("option",{children:"Grade 6-9"}),e.jsx("option",{children:"Grade 10"}),e.jsx("option",{children:"Grade 11 (O/L)"}),e.jsx("option",{children:"Grade 12-13 (A/L)"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"What do you need?"}),e.jsx("textarea",{placeholder:"e.g. I need Unit 5 Trigonometry notes with worked examples...",className:"form-input",required:!0,rows:4,style:{resize:"vertical",minHeight:"100px"},value:t.note_content,onChange:s=>n({...t,note_content:s.target.value})})]}),e.jsx("button",{type:"submit",disabled:m,className:"btn-primary btn-full",style:{marginTop:"1rem"},children:m?"Posting...":"Post Request"})]})]})})]})}export{G as default};
