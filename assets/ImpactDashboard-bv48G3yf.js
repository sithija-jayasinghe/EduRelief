import{s as y,j as s}from"./index-CTmt-P1O.js";import{r as l}from"./router-DmZmTQD2.js";import{A as H,D as I,B as N,I as O,H as w,b as _,s as v,q as U,f as J,J as K}from"./icons-C3RlEb-g.js";import"./react-vendor-ZjeaK7N3.js";import"./supabase-C8HnRnw-.js";function Y(){const[m,S]=l.useState({totalDownloads:0,totalMaterials:0,totalContributors:0,totalRequests:0,requestsFulfilled:0}),[b,M]=l.useState({}),[,C]=l.useState({}),[q,z]=l.useState({}),[E,A]=l.useState([]),[D,G]=l.useState([]),[T,g]=l.useState(!0),[d,R]=l.useState({missing:[],low:[]});l.useEffect(()=>{B()},[]);const B=async()=>{g(!0);try{const{data:e,error:t}=await y.from("notes").select("*");if(t)throw t;const{data:r,error:c}=await y.from("requests").select("*");if(c)throw c;const o=e?.reduce((a,n)=>a+(n.downloads||0),0)||0,h=[...new Set(e?.map(a=>a.author)||[])],j=r?.filter(a=>a.fulfilled).length||0;S({totalDownloads:o,totalMaterials:e?.length||0,totalContributors:h.length,totalRequests:r?.length||0,requestsFulfilled:j});const x={};e?.forEach(a=>{x[a.grade]=(x[a.grade]||0)+1}),M(x);const i={};e?.forEach(a=>{i[a.subject]=(i[a.subject]||0)+1}),C(i);const u={};e?.forEach(a=>{u[a.type||"Note"]=(u[a.type||"Note"]||0)+1}),z(u);const p=e?.sort((a,n)=>new Date(n.created_at)-new Date(a.created_at)).slice(0,10)||[];A(p);const f={};e?.forEach(a=>{f[a.author]=(f[a.author]||0)+1});const L=Object.entries(f).sort((a,n)=>n[1]-a[1]).slice(0,5).map(([a,n])=>({name:a,count:n}));G(L),k(e||[],r||[])}catch(e){console.error("Error fetching stats:",e)}finally{g(!1)}},k=(e,t)=>{const r=["Mathematics","Science","English","Sinhala","Tamil","Combined Mathematics","Physics","Chemistry","Biology","Economics","Accounting","ICT","History","Geography"],c={};e.forEach(i=>{const u=i.subject?.toLowerCase();r.forEach(p=>{u?.includes(p.toLowerCase())&&(c[p]=(c[p]||0)+1)})});const o=r.filter(i=>!c[i]),h=r.filter(i=>c[i]&&c[i]<3).map(i=>({subject:i,count:c[i]})),j=t.filter(i=>!i.fulfilled),x=[...new Set(j.map(i=>i.subject))];R({missing:o,low:h,requested:x.slice(0,5)})},F=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),$=e=>{const t=new Date(e),c=new Date-t,o=Math.floor(c/6e4),h=Math.floor(c/36e5),j=Math.floor(c/864e5);return o<60?`${o}m ago`:h<24?`${h}h ago`:`${j}d ago`};return T?s.jsx("div",{className:"container py-16 text-center",children:s.jsx("p",{className:"text-gray-500",children:"Loading impact data..."})}):s.jsxs("div",{className:"container py-8",children:[s.jsxs("div",{className:"page-header",children:[s.jsxs("div",{className:"header-title-row",children:[s.jsx(H,{size:28,className:"header-icon"}),s.jsx("h1",{className:"text-3xl",children:"Impact Dashboard"})]}),s.jsx("p",{className:"page-description",children:"See how BrightMindAid is helping Sri Lankan students affected by natural disasters. Every contribution makes a difference!"})]}),s.jsxs("div",{className:"impact-stats-grid",children:[s.jsxs("div",{className:"impact-stat-card primary",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(I,{size:28})}),s.jsxs("div",{className:"stat-info",children:[s.jsx("span",{className:"stat-number",children:F(m.totalDownloads)}),s.jsx("span",{className:"stat-label",children:"Total Downloads"})]})]}),s.jsxs("div",{className:"impact-stat-card success",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(N,{size:28})}),s.jsxs("div",{className:"stat-info",children:[s.jsx("span",{className:"stat-number",children:m.totalMaterials}),s.jsx("span",{className:"stat-label",children:"Study Materials"})]})]}),s.jsxs("div",{className:"impact-stat-card warning",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(O,{size:28})}),s.jsxs("div",{className:"stat-info",children:[s.jsx("span",{className:"stat-number",children:m.totalContributors}),s.jsx("span",{className:"stat-label",children:"Contributors"})]})]}),s.jsxs("div",{className:"impact-stat-card info",children:[s.jsx("div",{className:"stat-icon",children:s.jsx(w,{size:28})}),s.jsxs("div",{className:"stat-info",children:[s.jsxs("span",{className:"stat-number",children:[m.requestsFulfilled,"/",m.totalRequests]}),s.jsx("span",{className:"stat-label",children:"Requests Fulfilled"})]})]})]}),s.jsxs("div",{className:"charts-row",children:[s.jsxs("div",{className:"chart-card",children:[s.jsxs("h3",{children:[s.jsx(N,{size:18})," Materials by Grade"]}),s.jsx("div",{className:"bar-chart",children:Object.entries(b).map(([e,t])=>s.jsxs("div",{className:"bar-item",children:[s.jsx("div",{className:"bar-label",children:e.replace("Grade ","G")}),s.jsx("div",{className:"bar-container",children:s.jsx("div",{className:"bar-fill",style:{width:`${t/Math.max(...Object.values(b))*100}%`}})}),s.jsx("div",{className:"bar-value",children:t})]},e))})]}),s.jsxs("div",{className:"chart-card",children:[s.jsxs("h3",{children:[s.jsx(_,{size:18})," Materials by Type"]}),s.jsx("div",{className:"pie-legend",children:Object.entries(q).map(([e,t],r)=>s.jsxs("div",{className:"legend-item",children:[s.jsx("span",{className:`legend-color color-${r}`}),s.jsx("span",{className:"legend-label",children:e}),s.jsx("span",{className:"legend-count",children:t})]},e))})]})]}),s.jsxs("div",{className:"gap-analysis-section",children:[s.jsxs("h3",{children:[s.jsx(v,{size:20})," Gap Analysis - Materials Needed"]}),s.jsxs("div",{className:"gap-cards",children:[d.missing.length>0&&s.jsxs("div",{className:"gap-card danger",children:[s.jsxs("h4",{children:[s.jsx(v,{size:16})," Missing Subjects"]}),s.jsx("p",{children:"No materials available for:"}),s.jsx("div",{className:"gap-tags",children:d.missing.map(e=>s.jsx("span",{className:"gap-tag",children:e},e))})]}),d.low.length>0&&s.jsxs("div",{className:"gap-card warning",children:[s.jsxs("h4",{children:[s.jsx(v,{size:16})," Low Coverage"]}),s.jsx("p",{children:"Need more materials for:"}),s.jsx("div",{className:"gap-tags",children:d.low.map(e=>s.jsxs("span",{className:"gap-tag",children:[e.subject," (",e.count,")"]},e.subject))})]}),d.requested?.length>0&&s.jsxs("div",{className:"gap-card info",children:[s.jsxs("h4",{children:[s.jsx(U,{size:16})," Requested by Students"]}),s.jsx("p",{children:"Students are asking for:"}),s.jsx("div",{className:"gap-tags",children:d.requested.map(e=>s.jsx("span",{className:"gap-tag",children:e},e))})]})]})]}),s.jsxs("div",{className:"bottom-row",children:[s.jsxs("div",{className:"activity-card",children:[s.jsxs("h3",{children:[s.jsx(J,{size:18})," Recent Uploads"]}),s.jsx("div",{className:"activity-list",children:E.map(e=>s.jsxs("div",{className:"activity-item",children:[s.jsx("div",{className:"activity-icon",children:s.jsx(N,{size:16})}),s.jsxs("div",{className:"activity-info",children:[s.jsx("span",{className:"activity-title",children:e.title}),s.jsxs("span",{className:"activity-meta",children:[e.subject," â€¢ ",e.grade]})]}),s.jsx("span",{className:"activity-time",children:$(e.created_at)})]},e.id))})]}),s.jsxs("div",{className:"contributors-card",children:[s.jsxs("h3",{children:[s.jsx(K,{size:18})," Top Contributors"]}),s.jsx("div",{className:"contributors-list",children:D.map((e,t)=>s.jsxs("div",{className:"contributor-item",children:[s.jsx("div",{className:`rank rank-${t+1}`,children:t===0?"ðŸ¥‡":t===1?"ðŸ¥ˆ":t===2?"ðŸ¥‰":`#${t+1}`}),s.jsxs("div",{className:"contributor-info",children:[s.jsx("span",{className:"contributor-name",children:e.name}),s.jsxs("span",{className:"contributor-count",children:[e.count," materials"]})]})]},e.name))}),s.jsxs("div",{className:"cta-section",children:[s.jsx("p",{children:"Want to be on this list?"}),s.jsx("a",{href:"#/",className:"text-primary",children:"Share materials â†’"})]})]})]}),s.jsx("div",{className:"impact-cta",children:s.jsxs("div",{className:"cta-content",children:[s.jsxs("h3",{children:[s.jsx(w,{size:20})," Help Fill the Gaps!"]}),s.jsx("p",{children:"Students affected by floods and landslides need your help. If you have study materials, please share them with the community."}),s.jsxs("a",{href:"#/",className:"btn-primary",children:[s.jsx(N,{size:18}),"Share Materials Now"]})]})})]})}export{Y as default};
